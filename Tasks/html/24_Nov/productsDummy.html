<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Single product</title>
    <link rel="stylesheet" href="/dist/output.css">
</head>

<body>
    <main class="py-8">
        <div class="container mx-auto">
            <div class="flex">
                <!-- Product images -->
                <div class="w-1/2">
                    <div class="w-full h-96">
                        <img id="js-image" alt="Product Image" class="w-full h-full object-cover">
                    </div>
                    <div id="js-imagesContainer" class="flex mt-4 space-x-4">

                    </div>
                </div>

                <!-- Product information -->
                <div class="w-1/2 p-8">
                    <h1 class="text-3xl font-bold mb-4" id="js-title">Product Name</h1>
                    <p class="text-gray-600 mb-4" id="js-description">Product Description</p>
                    <p class="text-2xl text-orange-500 font-bold mb-4" id="js-price">$99.99</p>

                    <!-- Add to Cart button -->
                    <button type="button" id="js-cartButton" class="bg-blue-500 text-white px-4 py-2 rounded">Add to
                        Cart</button>
                </div>
            </div>
        </div>
    </main>
    <script>
        (function () {
            "use strict"
            const singleProduct = {
                render: async function () {
                    const title = document.querySelector('#js-title');
                    const description = document.querySelector('#js-description')
                    const price = document.querySelector('#js-price')
                    const image = document.querySelector('#js-image')
                    const imagesContainer = document.querySelector('#js-imagesContainer');
                    const urlParam = singleProduct.methods.productId()
                    try {
                        const response = await fetch(`https://dummyjson.com/products/${urlParam}`);
                        if (response.ok) {
                            const data = await response.json();

                            if (data.id) {
                                image.src = data.thumbnail;
                                title.innerHTML = data.title;
                                description.innerHTML = data.description;
                                price.innerHTML = `$${data.price}`;
                            }

                            data.images.map((item) => {
                                let sideImages = document.createElement("img");
                                sideImages.setAttribute("src", `${item}`);
                                sideImages.setAttribute("class", "w-40 h-32 mx-auto mt-32 p-2 border-2 cursor-pointer")
                                imagesContainer.appendChild(sideImages);

                                sideImages.addEventListener("click", () => {
                                    image.src = sideImages.src;
                                })
                            })

                        }
                        else {
                            throw new Error('Error');
                        }
                    }
                    catch (error) {
                        console.error('Error fetching data:', error);
                        return null;
                    }
                },

                existingLocalData: function () {
                    const cartData = this.methods.getCartStorage() || [];
                    return cartData;
                },

                methods: {
                    productId: function () {
                        const keysValues = window.location.search;
                        const urlParams = new URLSearchParams(keysValues)
                        const param = urlParams.get('id')
                        return param
                    },

                    increaseCount: function () {
                        const productID = singleProduct.methods.productId();
                        const cartData = singleProduct.existingLocalData()
                        const existingItemIndex = cartData.findIndex((item) => item.id == productID);

                        if (existingItemIndex !== -1) {
                            console.log("Existing item found:");
                            const increamentCount = cartData[existingItemIndex].count += 1;
                            this.setCartStorage(cartData);
                        }
                    },

                    setCartStorage: function (cartData) {
                        localStorage.setItem('cartStorage', JSON.stringify(cartData));
                    },

                    addToCart: function () {
                        const cartButton = document.querySelector('#js-cartButton')
                        cartButton.addEventListener("click", (e) => {
                            this.increaseCount();
                            window.location.href = `dummyCart.html?id=${this.productId()}`
                        })
                    },

                    getCartStorage: function () {
                        const cart = JSON.parse(localStorage.getItem('cartStorage'))
                        return cart;
                    },
                }
            }
            singleProduct.render()
            singleProduct.methods.addToCart()
            singleProduct.methods.getCartStorage()
        })()
    </script>
</body>

</html>