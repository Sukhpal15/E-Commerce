<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/dist/output.css">
</head>

<body class="bg-gray-100 font-sans">
    <!-- Admin Panel Header -->
    <header class="bg-blue-500 p-4 text-white shadow-md">
        <div class="container mx-auto">
            <h1 class="text-2xl font-semibold">Admin Form</h1>
        </div>
    </header>

    <!-- Admin Panel Content -->
    <div class="container mx-auto mt-8">
        <div class="flex justify-between px-16 gap-8 items-center">
            <input type="search" class="border-2 w-96 p-2 h-11 rounded-lg shadow-md outline-none"
                placeholder="Search name" id="js_search">
            <button type="button" class="bg-blue-500 w-44 p-1 rounded-md font-semibold shadow-md text-white h-11"
                id="js_addTask">Add New User Data</button>
        </div>

        <div class="flex justify-center mt-8">
            <div class="w-11/12 flex bg-white shadow-lg rounded-lg">
                <table class=" text-center w-full divide-gray-100">
                    <thead class="h-16 bg-blue-500  ">
                        <tr class="text-white font-normal">
                            <th class="py-2 font-semibold rounded-tl-md">User Image</th>
                            <th class="py-2 font-semibold">Name</th>
                            <th class="py-2 font-semibold">Email</th>
                            <th class="py-2 font-semibold">Blood Group</th>
                            <th class="py-2 font-semibold">Roles</th>
                            <th class="py-2 font-semibold">View</th>
                            <th class="py-2 font-semibold">Edit</th>
                            <th class="py-2 font-semibold rounded-tr-md">Delete</th>
                        </tr>
                    </thead>
                    <tbody id="js_tbody" class="divide-y-2 divide-gray-100"></tbody>
                </table>
            </div>
        </div>
    </div>

    <dialog id="viewDialog" class="bg-white p-4 rounded-lg shadow-lg">
        <div>
            <h2 class="text-lg font-semibold">View Details</h2>
            <div id="viewDialogContent" class="mt-4"></div>
            <button id="closeViewDialog"
                class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 focus:outline-none focus:ring focus:border-blue-300">Close</button>
        </div>
    </dialog>

    <dialog id="js_confirmationDialog" class="bg-white p-4 rounded-lg shadow-lg">
        <div>
            <p>Are you sure you want to delete this data?</p>
            <div>
                <button id="js_confirmDelete"
                    class="mt-5 mr-5 bg-red-500 text-white w-20 h-8 rounded hover:bg-red-700 focus:outline-none focus:border-red-300">Yes</button>
                <button id="js_cancelDelete"
                    class="bg-blue-500 text-white w-20 h-8 rounded hover:bg-blue-700 focus:outline-none focus:border-blue-300">No</button>
            </div>
        </div>
    </dialog>

    <script>
        const fetchData = {
            load: JSON.parse(localStorage.getItem('formDataArray')) || [],

            insertData: function () {
                const tbody = document.getElementById('js_tbody');
                const searchInput = document.getElementById('js_search')

                // Clear existing rows
                tbody.innerHTML = '';

                // Filter data based on search input
                const filteredData = this.load.filter(data =>
                    data.first_name.toLowerCase().startsWith(searchInput.value.toLowerCase())
                );

                // Loop through the data and create rows
                filteredData.forEach((data) => {
                    const row = document.createElement('tr');
                    row.className = "mt-10"
                    const imageCell = document.createElement('td');
                    imageCell.className = "flex justify-center p-2";
                    const createImageTag = document.createElement('img')
                    createImageTag.src = data.image
                    createImageTag.className = "h-20 rounded-full"
                    createImageTag.setAttribute('id', 'js_fetch_image')

                    imageCell.appendChild(createImageTag)
                    row.appendChild(imageCell);

                    // Add data to each cell
                    const nameCell = document.createElement('td');
                    nameCell.textContent = `${data.first_name} ${data.last_name}`;
                    row.appendChild(nameCell);

                    const emailCell = document.createElement('td');
                    emailCell.textContent = data.email;
                    row.appendChild(emailCell);

                    const bloodGroupCell = document.createElement('td');
                    bloodGroupCell.textContent = data.blood_group;
                    row.appendChild(bloodGroupCell);

                    const rolesCell = document.createElement('td');
                    rolesCell.textContent = data.roles;
                    row.appendChild(rolesCell);

                    const viewCell = document.createElement('td');
                    const viewLink = document.createElement('a');
                    viewLink.href = `#`;
                    viewLink.className = "bg-blue-500 text-white px-4 py-1 rounded-full hover:bg-blue-700 focus:outline-none focus:ring focus:border-blue-300"
                    viewLink.textContent = 'View';
                    viewCell.appendChild(viewLink);
                    row.appendChild(viewCell);

                    const editCell = document.createElement('td');
                    const editButton = document.createElement('button');
                    editButton.setAttribute('type', 'button')
                    editButton.className = "bg-yellow-500 text-white px-4 py-1 rounded-full rounded hover:bg-yellow-700 focus:outline-none focus:ring focus:border-yellow-300"
                    editButton.textContent = 'Edit';
                    editCell.appendChild(editButton);
                    row.appendChild(editCell);
                    editButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.editData(data.id);
                    });

                    const deleteCell = document.createElement('td');
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.className = "bg-red-500 text-white px-4 py-1 rounded-full rounded hover:bg-red-700 focus:outline-none focus:ring focus:border-red-300;"
                    deleteButton.addEventListener('click', () => { this.deleteData(data.id) });
                    deleteCell.appendChild(deleteButton);
                    row.appendChild(deleteCell);

                    tbody.appendChild(row);
                    viewLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.viewData(data);
                    });
                });
            },

            deleteData: function (id) {
                const indexToDelete = this.load.findIndex(item => item.id === id);
                const confirmationDialog = document.getElementById('js_confirmationDialog');
                const confirmDeleteButton = document.getElementById('js_confirmDelete');
                const cancelDeleteButton = document.getElementById('js_cancelDelete');
                confirmationDialog.showModal();
                confirmDeleteButton.addEventListener('click', () => {
                    const indexToDelete = this.load.findIndex(item => item.id === id);

                    if (indexToDelete !== -1) {
                        this.load.splice(indexToDelete, 1);

                        localStorage.setItem('formDataArray', JSON.stringify(this.load));

                        this.insertData();
                    }

                    confirmationDialog.close();
                });

                cancelDeleteButton.addEventListener('click', () => {
                    confirmationDialog.close();
                });
            },


            editData: function (id) {
                console.log(`Edit data with ID: ${id}`);
                window.location.href = `formAdd.html?id=${id}`;
            },

            viewData: function (data) {
                const viewDialogContent = document.getElementById('viewDialogContent');
                viewDialogContent.innerHTML = '';

                const keys = Object.keys(data);
                keys.forEach((key) => {
                    const row = document.createElement('div');
                    if (key == 'image') {
                        const imageElement = document.createElement('img');
                        imageElement.classList.add('w-16')
                        imageElement.src = data[key];
                        imageElement.alt = 'User Image';
                        row.appendChild(imageElement);
                    }
                    else {
                        row.innerHTML = `<strong>${key}:</strong> ${data[key]}`;
                    }
                    viewDialogContent.appendChild(row);
                });

                // Show the dialog
                const viewDialog = document.getElementById('viewDialog');
                viewDialog.showModal();

                // Add event listener to close the dialog
                const closeViewDialog = document.getElementById('closeViewDialog');
                closeViewDialog.addEventListener('click', () => {
                    viewDialog.close();
                });
            },

            debounce: function (func, delay) {
                let timer;
                return function () {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timer);
                    timer = setTimeout(function () {
                        func.apply(context, args);
                    }, delay);
                };
            },

            search: function () {

                const searchInput = document.getElementById('js_search')

                searchInput.addEventListener('input', this.debounce((e) => {
                    this.insertData();
                }, 500));
            },

            addData: function () {
                const add = document.getElementById('js_addTask');
                add.addEventListener('click', function (e) {
                    e.preventDefault();
                    window.location.href = "formAdd.html"
                })
            }

        }
        fetchData.insertData()
        fetchData.search()
        fetchData.addData()
    </script>
</body>

</html>