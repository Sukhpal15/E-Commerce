<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/./dist/output.css">
  </head>
  <body class="bg-slate-200">
    <ul class="p-2 divide-y-2 w-36 rounded-md space-y-3 bg-white hidden" id="context">
      <li><button type="button">Copy</button></li>
      <li><button type="button">Paste</button></li>
      <li><button type="button">Cut</button></li>
      <li><button type="button">Delete</button></li>
      <li class="relative">
        <button type="button" class="w-full text-start" id="js_new">New</button>
        <ul
          class="p-2 divide-y-2 w-36 rounded-md space-y-3 bg-white text-sm absolute invisible"
          id="js_subMenu"
        >
          <li><button type="button" class="w-full text-start">New Folder</button></li>
          <li><button type="button" class="w-full text-start">New File</button></li>
          <li><button type="button" class="w-full text-start">New Shortcut</button></li>
          <li><button type="button" class="w-full text-start">New Shortcut</button></li>
          <li><button type="button" class="w-full text-start">Microsoft Word Document</button></li>
        </ul>
      </li>
      <li><button type="button">Inspect</button></li>
    </ul>
  <script>
    const contentMenu = document.getElementById("context");
    const newJs = document.getElementById("js_new");
    let subMenu = document.getElementById("js_subMenu");
    let innerWidth = window.innerWidth;
    let innerHeight = window.innerHeight;
    window.addEventListener("click", (e) => {
      if (e.target != newJs) {
        contentMenu.classList.remove(`fixed`);
        contentMenu.classList.add(`hidden`);
        subMenu.classList.add("invisible");
      }
    });
    newJs.addEventListener("click", (e) => {
      subMenu.classList.remove("invisible");
    });
    
    window.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      subMenu.classList.add("invisible");
      contentMenu.classList.remove(`hidden`);
      contentMenu.classList.add(`fixed`);
      let x = e.clientX;
      let y = e.clientY;
      
      let cmWidth = contentMenu.offsetWidth;
      let cmHeight = contentMenu.offsetHeight;
      
      let remainingHeight = innerHeight - y;
      let remainingWidth = innerWidth - x;
       let subOffset = subMenu.offsetWidth
      
      if (x > innerWidth - cmWidth) {
        console.log('hello')
        x = remainingWidth;
        contentMenu.style.left = ``;
        contentMenu.style.right = `${x}px`;
        subMenu.style.left = ``;
        subMenu.style.right = `${cmWidth}px`;
      }
      else if(x > innerWidth - cmWidth - subOffset){
        // x = remainingWidth;
        // contentMenu.style.left = ``;
        // contentMenu.style.right = `${x}px`;
        contentMenu.style.left = `${x}px`;
        subMenu.style.left = ``;
        subMenu.style.right = `${cmWidth}px`;
      }
      else {
        contentMenu.style.left = `${x}px`;
        subMenu.style.right = ``;
        subMenu.style.left = `${cmWidth}px`;
      }
      if (y > innerHeight - cmHeight) {
        y = remainingHeight;
        contentMenu.style.top = ``;
        contentMenu.style.bottom = `${y}px`;
        subMenu.style.top = ``;
        subMenu.style.bottom = `${cmHeight - subMenu.offsetHeight}px`;
      } else {
        contentMenu.style.bottom = ``;
        contentMenu.style.top = `${y}px`;
        subMenu.style.bottom = ``;
        subMenu.style.top = `${cmHeight - subMenu.offsetHeight}px`;
      }
    });
  </script>
  </body>
</html>
